<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Menu principal Agriculture RH -->
        <menuitem id="menu_bsr_agri_rh_root" 
                  name="Ressources Humaines" 
                  parent="bsr_agri_base.menu_agriculture_root"
                  sequence="30" />

        <!-- Sous-menu Équipes -->
        <menuitem id="menu_bsr_agri_rh_teams" 
                  name="Équipes Agricoles" 
                  parent="menu_bsr_agri_rh_root"
                  action="action_bsr_agri_team"
                  sequence="10" />

        <!-- Sous-menu Affectations -->
        <menuitem id="menu_bsr_agri_rh_assignments" 
                  name="Affectations" 
                  parent="menu_bsr_agri_rh_root"
                  action="action_bsr_team_assignment"
                  sequence="20" />

        <!-- Sous-menu Planning -->
        <menuitem id="menu_bsr_agri_rh_planning" 
                  name="Planning des Équipes" 
                  parent="menu_bsr_agri_rh_root"
                  action="action_bsr_team_assignment_planning"
                  sequence="30" />

        <!-- Menu Configuration -->
        <menuitem id="menu_bsr_agri_rh_config" 
                  name="Configuration" 
                  parent="menu_bsr_agri_rh_root"
                  sequence="90"
                  groups="hr.group_hr_manager" />

        <!-- Sous-menu Compétences Agricoles -->
        <menuitem id="menu_bsr_agri_skills" 
                  name="Compétences Agricoles" 
                  parent="menu_bsr_agri_rh_config"
                  action="action_hr_skill_agriculture"
                  sequence="10" />

        <!-- Sous-menu Employés avec compétences agricoles -->
        <menuitem id="menu_bsr_agri_employees" 
                  name="Employés Agricoles" 
                  parent="menu_bsr_agri_rh_config"
                  action="action_hr_employee_agricultural_skills"
                  sequence="20" />

        <!-- Action pour voir les affectations d'une équipe (utilisée dans les vues) -->
        <record id="action_team_assignments" model="ir.actions.act_window">
            <field name="name">Affectations de l'équipe</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">bsr.team.assignment</field>
            <field name="view_mode">tree,form,calendar,gantt</field>
            <field name="domain">[('team_id', '=', active_id)]</field>
            <field name="context">{'default_team_id': active_id}</field>
        </record>

        <!-- Action pour voir les équipes d'un employé -->
        <record id="action_employee_teams" model="ir.actions.act_window">
            <field name="name">Équipes de l'employé</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">bsr.agri.team</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="domain">[('member_ids', 'in', [active_id])]</field>
        </record>

        <!-- Ajouter bouton dans vue employé pour voir ses équipes -->
        <record id="view_hr_employee_form_inherit_teams" model="ir.ui.view">
            <field name="name">hr.employee.form.inherit.teams</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
                <div name="button_box" position="inside">
                    <button name="%(action_employee_teams)d" 
                            type="action" 
                            class="oe_stat_button" 
                            icon="fa-users">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_text">Équipes Agri</span>
                        </div>
                    </button>
                </div>
            </field>
        </record>

        <!-- Ajouter une page dans la vue employé pour ses compétences agricoles -->
        <record id="view_hr_employee_form_inherit_agri_skills" model="ir.ui.view">
            <field name="name">hr.employee.form.inherit.agri.skills</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr_skills.hr_employee_view_form"/>
            <field name="arch" type="xml">
                <page name="public" position="after">
                    <page string="Compétences Agricoles" name="agri_skills">
                        <group>
                            <group>
                                <field name="specialization_area"/>
                                <field name="agricultural_experience_years"/>
                            </group>
                            <group>
                                <field name="agricultural_certifications_count" readonly="1"/>
                                <field name="is_available_for_operations"/>
                                <field name="max_concurrent_assignments"/>
                            </group>
                        </group>
                        
                        <separator string="Compétences agricoles spécialisées"/>
                        <field name="agricultural_skill_ids" context="{'default_employee_id': active_id}">
                            <tree editable="bottom">
                                <field name="skill_id" domain="[('is_agricultural_skill', '=', True)]"/>
                                <field name="skill_level_id" domain="[('skill_type_id', '=', skill_type_id)]"/>
                                <field name="skill_type_id" readonly="1"/>
                                <field name="certification_date"/>
                                <field name="certification_expiry" readonly="1"/>
                                <field name="certification_status" readonly="1"/>
                            </tree>
                        </field>
                        
                        <separator string="Équipes"/>
                        <group>
                            <field name="team_ids" widget="many2many_tags"/>
                            <field name="led_team_ids" widget="many2many_tags" readonly="1"/>
                        </group>
                    </page>
                </page>
            </field>
        </record>

    </data>
</odoo>